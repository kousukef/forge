---
category: pattern
stack: general
severity: important
date: 2026-02-18
tags: commands, argument-hint, sync, claude-code, workflow
---

# コマンド引数システムの追加とプロジェクト/グローバル同期漏れ

## 何が起きたか

Forge ワークフローコマンド7本に argument-hint・モードフラグ・change-name 引数を追加し、冗長な Skill Activation セクションを削除した。プロジェクト側（`forge/commands/`）の変更は完了したが、グローバル側（`~/.claude/commands/`）への同期が実施されず、グローバル側には Skill Activation が残存し argument-hint が欠落した状態になった。

## なぜ起きたか

1. **タスクリストの依存関係設計は正しかった**: Task 8（同期）は Task 1-7 に依存として定義されていた
2. **実行時の同期ステップが漏れた**: 実装の最終ステップとしてグローバル同期が実行されなかった
3. **検証（Task 9）も未実行**: 最終検証として diff による同期確認が定義されていたが実行されなかった

## どう解決したか

`/compound` 実行時に同期漏れを検出。プロジェクト側のファイルをグローバル側にコピーすることで解決（本 compound セッション内で対応予定）。

## 教訓

1. **同期タスクは自動化すべき**: プロジェクトとグローバルの2箇所に配置するファイルは、手動同期に頼ると必ず漏れる。フックまたはスクリプトによる自動同期が望ましい
2. **最終検証ステップは省略不可**: タスクリストに検証ステップが含まれていても、実行されなければ意味がない。検証を最終コミットの前提条件として強制する仕組みが必要
3. **argument-hint パターンは有効**: `argument-hint` + `$ARGUMENTS` の組み合わせはコマンドの使い勝手を大きく改善する。新規コマンド作成時のテンプレートに含めるべき

## 防止策

- [ ] ルールの追加・更新が必要か → 同期確認を検証ステップに明示的に追加を検討
- [ ] スキルの追加・更新が必要か → 現時点では不要
- [x] フックの追加・更新が必要か → プロジェクト/グローバル同期の自動フックを将来検討（今回は手動対応）
